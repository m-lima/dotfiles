#!/bin/bash

shift

while (( $# > 0 )); do
  case "${1}" in
    nightly)
      nightly='+nightly' ;;
    run|r)
      run=1 ;;
    clean|c)
      clean=1 ;;
  esac
  shift
done

if [ ${clean} ]; then
  echo "[34mCleaning[m" && \
  cargo clean
fi
echo "[34mFormatting[m" && \
cargo ${nightly} fmt --all && \
echo "[34mBuilding main[m" && \
cargo ${nightly} build --workspace ${@} && \
echo "[34mBuilding examples[m" && \
cargo ${nightly} build --workspace --examples ${@} && \
echo "[34mLinting main[m" && \
cargo ${nightly} clippy --workspace ${@} && \
echo "[34mLinting examples[m" && \
cargo ${nightly} clippy --workspace --examples ${@} && \
echo "[34mTesting main[m" && \
cargo ${nightly} test --workspace ${@}
if [ "${run}" ]; then
  echo "[34mRunning[m" && \
  cargo ${nightly} run ${@}
fi
